(function(h){typeof define=="function"&&define.amd?define(h):h()})(function(){"use strict";var z=Object.defineProperty;var P=(h,p,u)=>p in h?z(h,p,{enumerable:!0,configurable:!0,writable:!0,value:u}):h[p]=u;var y=(h,p,u)=>(P(h,typeof p!="symbol"?p+"":p,u),u);const h=["overlayCheckout","salesFunnel","inlineCheckout","element:creditCardForm"],p=(m,t)=>{const{id:n,minHeight:s,minWidth:o}=t,e=document.createElement("iframe");return n&&(e.id=n),e.className="custom-element__iframe",e.style.width="100%",e.style.minWidth=o??"320px",e.style.minHeight=s??"300px",e.style.border="0 none",e.style.display="block",e.allow="clipboard-write; payment *",e.src=m,e},u="https://pay.hotmart.com",b="https://pci-pay.hotmart.com";class C{constructor(t,n){y(this,"options",{payment:{},visibilityOptions:{}});y(this,"wrapperElement");y(this,"iframeElement");y(this,"iframeURL",new URL(u));y(this,"iframeOptions",{});this.options=t,console.debug("@@@@ this.options:",this.options);const o={...{elements_document_height_update:e=>{this.iframeElement&&(this.iframeElement.style.height=e)},on_load:()=>{var e,d,f,c,a,r,i,l,v,g,O;this.postMessage({action:"set_data",data:{shopperData:(e=this.options.payment)==null?void 0:e.shopperData,hasErrorCallback:!!((d=this.options.payment)!=null&&d.onError),countryIsoCode:((f=this.options)==null?void 0:f.countryIsoCode)??"",gateways:(r=(a=(c=this.options)==null?void 0:c.elementOptions)==null?void 0:a.creditCardForm)==null?void 0:r.gateways,context:(v=(l=(i=this.options)==null?void 0:i.elementOptions)==null?void 0:l.creditCardForm)==null?void 0:v.context}}),(O=(g=this.options)==null?void 0:g.onLoad)==null||O.call(g)}},...n||{}};window.addEventListener("message",e=>{var f;const d=e.source!==((f=this.iframeElement)==null?void 0:f.contentWindow);e.origin!==this.iframeURL.origin||d||(console.debug("@@@@ message:",e),!(!e.data.action||!Object.keys(o).includes(e.data.action))&&o[e.data.action](e.data.data))})}updateOptions(t){this.options={...this.options,...t}}postMessage({action:t,data:n}){var s,o;(o=(s=this.iframeElement)==null?void 0:s.contentWindow)==null||o.postMessage({action:t,data:n},"*")}mount(t){var s;if(this.options.integrationKey&&this.iframeURL.searchParams.append("integrationKey",this.options.integrationKey),this.options.locale&&this.iframeURL.searchParams.append("locale",this.options.locale),this.options.countryIsoCode&&this.iframeURL.searchParams.append("countrycode",this.options.countryIsoCode),this.options.prefilledInfo)for(const[o,e]of Object.entries(this.options.prefilledInfo))this.iframeURL.searchParams.append(o,e);if(this.options.visibilityOptions)for(const[o,e]of Object.entries(this.options.visibilityOptions))this.iframeURL.searchParams.append(o,e);const n=p(this.iframeURL.href,this.iframeOptions);this.iframeElement=n,this.wrapperElement=typeof t=="string"?document.querySelector(t):t,this.wrapperElement&&(this.wrapperElement.innerHTML="",(s=this.wrapperElement)==null||s.appendChild(n),console.debug("@@@@ element mounted successfully"))}}class _ extends C{constructor(t,n){const s={on_payment_approve:o=>{var e,d;(d=(e=this.options.payment)==null?void 0:e.onSuccess)==null||d.call(e,o)},on_payment_error:o=>{var e,d;(d=(e=this.options.payment)==null?void 0:e.onError)==null||d.call(e,o)},on_submit_payment:({actionToCall:o})=>{var e,d;this.postMessage({action:"process_payment",data:{shopperData:(e=this.options.payment)==null?void 0:e.shopperData,hasErrorCallback:!!((d=this.options.payment)!=null&&d.onError),actionToCall:o}})},...n||{}};super(t,s),this.iframeURL=new URL(`${u}/elements?off=${this.options.offer}&checkoutMode=2`),this.options.bid=new Date().getTime()}}class T extends _{constructor(t){super(t),console.debug("@@@@ Initializing OverlayCheckout element"),Promise.resolve().then(()=>U).then(n=>{const s=document.createElement("style");s.innerText=n.default,document.head.append(s)})}onKeyUp(t){t.key==="Escape"&&this.destroy()}attach(t){const n=typeof t=="string"?document.querySelector(t):t;t&&(n==null||n.addEventListener("click",s=>{s.preventDefault();const o=document.createElement("div");o.id="custom-element-lightbox-overlay",o.className="custom-element__lightbox-overlay",o.addEventListener("click",()=>{this.destroy()});const e=document.createElement("div");e.id="custom-element-lightbox-modal",e.className="custom-element__lightbox-modal",super.mount(e),document.body.appendChild(o),document.body.appendChild(e)}),document.addEventListener("keyup",s=>this.onKeyUp(s)),console.debug("@@@@ OverlayCheckout attached successfully"))}mount(t){this.attach(t)}destroy(){var t,n;(t=document.getElementById("custom-element-lightbox-overlay"))==null||t.remove(),(n=document.getElementById("custom-element-lightbox-modal"))==null||n.remove()}}class x extends _{constructor(t){super(t),this.iframeURL=new URL(`${u}/funnel${this.getMainPageSearchParams()}`),console.debug("@@@@ Initializing SalesFunnel element")}getMainPageSearchParams(){var t;try{const n=(t=window.top)==null?void 0:t.location,s=window.location,o=(n==null?void 0:n.search)||s.search||"";if(o)return o;const e=n||s;return(e==null?void 0:e.search)||`?${e.toString().split("?")[1]}`}catch{return window.location.search||""}}}class I extends _{constructor(t){super(t),this.iframeURL=new URL(`${u}/elements?off=${this.options.offer}&checkoutMode=2`),console.debug("@@@@ Initializing InlineCheckout element")}}class F extends C{constructor(n){var d,f;const s={on_generate_tokens_intent_success:c=>{var a,r,i,l;this._resolveTokenization(c),(l=(i=(r=(a=this.options)==null?void 0:a.elementOptions)==null?void 0:r.creditCardForm)==null?void 0:i.onGenerateTokensSuccess)==null||l.call(i,c)},on_generate_tokens_intent_error:c=>{var a,r,i,l;this._rejectTokenization(c),(l=(i=(r=(a=this.options)==null?void 0:a.elementOptions)==null?void 0:r.creditCardForm)==null?void 0:i.onGenerateTokensError)==null||l.call(i,c)},on_credit_card_form_valid:()=>{var c,a,r,i;(i=(r=(a=(c=this.options)==null?void 0:c.elementOptions)==null?void 0:a.creditCardForm)==null?void 0:r.onValidationSuccess)==null||i.call(r)},on_credit_card_form_invalid:c=>{var a,r,i,l;(l=(i=(r=(a=this.options)==null?void 0:a.elementOptions)==null?void 0:r.creditCardForm)==null?void 0:i.onValidationError)==null||l.call(i,c)},on_credit_card_form_blur:c=>{var a,r,i,l;(l=(i=(r=(a=this.options)==null?void 0:a.elementOptions)==null?void 0:r.creditCardForm)==null?void 0:i.onBlur)==null||l.call(i,c)},on_credit_card_info:c=>{var a,r,i,l;(l=(i=(r=(a=this.options)==null?void 0:a.elementOptions)==null?void 0:r.creditCardForm)==null?void 0:i.onCardInfoUpdate)==null||l.call(i,c)}},o=(f=(d=n.elementOptions)==null?void 0:d.creditCardForm)==null?void 0:f.gateways,e=o&&Array.isArray(o)&&o.length?o:["ADYEN","WORLDPAY","DLOCAL","PAYU","EBANX","YUNO"];n.elementOptions={...n.elementOptions,creditCardForm:{...n.elementOptions.creditCardForm,gateways:e}};super(n,s);y(this,"TOKENIZATION_TIMEOUT",12e3);y(this,"pendingTokenization",null);this.iframeURL=new URL(`${b}/elements/credit-card-form`),this.iframeOptions={minHeight:"0",minWidth:"210px"},console.debug("@@@@ Initializing creditCardForm element")}async generateTokens(){return this.pendingTokenization?Promise.reject(new Error("Tokenization already in progress")):new Promise((n,s)=>{const o=setTimeout(()=>this._rejectTokenization(new Error("Tokenization timeout")),this.TOKENIZATION_TIMEOUT);this.pendingTokenization={resolve:e=>{clearTimeout(o),this.pendingTokenization=null,n(e)},reject:e=>{clearTimeout(o),this.pendingTokenization=null,s(e)}};try{this.postMessage({action:"generate_tokens_intent",data:{}}),console.debug("@@@@ tryToGenerateTokens Button triggered")}catch(e){this._rejectTokenization(e)}})}_resolveTokenization(n){this.pendingTokenization&&this.pendingTokenization.resolve(n)}_rejectTokenization(n){this.pendingTokenization&&this.pendingTokenization.reject(n)}validateForm(){this.postMessage({action:"validate_intent",data:{}}),console.debug("@@@@ tryToValidateForm Button triggered")}}const k=(m,t={})=>{var e;if(t.off&&(t.offer=t.off),!(t.offer||t.affiliation)&&["overlayCheckout","inlineCheckout"].includes(m))throw new Error("Offer or affiliation must be present");if(m==="element:creditCardForm"&&!((e=t.elementOptions)!=null&&e.creditCardForm.context))throw new Error("Context must be present on credit card form elements options");const o={overlayCheckout:()=>new T(t),inlineCheckout:()=>new I(t),salesFunnel:()=>new x(t),"element:creditCardForm":()=>new F(t)};if(console.debug("@@@@ Initializing Checkout Elements"),!h.includes(m))throw new Error("Element type not available, please check the documentation");return o[m]()},L=10;let E=0;function w(){window.setTimeout(()=>{if(E>=L)return;E+=1;const m=Array.from(document.querySelectorAll("#hotmart-sales-funnel"));if(!m.length){w();return}m.some(t=>t.hasChildNodes())||k("salesFunnel").mount(m[0])},250)}w(),window.checkoutElements={init:k};const U=Object.freeze(Object.defineProperty({__proto__:null,default:".custom-element__iframe{border:none}.custom-element__lightbox-overlay{background-color:#000;position:fixed;width:100%;height:100%;top:0;left:0;opacity:.8}.custom-element__lightbox-modal{position:fixed;width:90%;max-width:90vw;min-height:500px;max-height:90vh;top:5%;left:50%;transform:translate(-50%);overflow:scroll}"},Symbol.toStringTag,{value:"Module"}))});
